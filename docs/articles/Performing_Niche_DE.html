<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Performing Niche-DE • nicheDE</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Performing Niche-DE">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="inverse" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">nicheDE</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../index.html">Home</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/Tutorial.html">Tutorial</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Documentation</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/Kmason23/NicheDE"><span class="fa fa-github"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Performing Niche-DE</h1>
            
      

      <div class="d-none name"><code>Performing_Niche_DE.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="running-niche-de">Running Niche-DE<a class="anchor" aria-label="anchor" href="#running-niche-de"></a>
</h2>
<p>Once you have set up your niche-DE object, you can run niche-DE using
the function ‘niche_DE’. This function takes 11 arguments</p>
<details><summary>
Arguments
</summary><ul>
<li>object: A niche-DE object</li>
<li>num_cores: The number of cores to use when performing
parallelization</li>
<li>outfile: The file path to the txt on which workers will write status
reports on</li>
<li>C: The minimum total expression of a gene across observations needed
for the niche-DE model to run. The default value is 150.</li>
<li>M: Minimum number of spots containing the index cell type with the
niche cell type in its effective niche for (index,niche) niche patterns
to be investigated. The default value is 10</li>
<li>Gamma: Percentile a gene needs to be with respect to expression in
the index cell type in order for the model to investigate niche patterns
for that gene in the index cell. The default value is 0.8 (80th
percentile)</li>
<li>print: Should the progress of niche-DE be tracked? If True, progress
updates will be tracked in the outfile of the cluster. Default is
True.</li>
<li>Int: Logical for if data is count data. If True, a negative binomial
regression is performed. Otherwise linear regression with a gene
specific variance is applied. Default is True.</li>
<li>Batch: Logical if an indicator should be included for each batch in
the regression. Default is True.</li>
<li>self_EN: Logical if niche interactions between the same cell types
should be considered. Default is False.</li>
<li>G: Number of gigabytes each core should hold. If the counts matrix
is bigger than G gigabytes, it is split into multiple chunks such that
the size of each chunk is less than G gigabytes.</li>
</ul></details><pre><code><span><span class="co">#Perform Niche-DE</span></span>
<span><span class="va">NDE_obj</span> <span class="op">=</span> <span class="fu"><a href="../reference/niche_DE.html">niche_DE</a></span><span class="op">(</span><span class="va">NDE_obj</span>,num_cores <span class="op">=</span> <span class="fl">4</span>,outfile <span class="op">=</span> <span class="st">""</span>,C <span class="op">=</span> <span class="fl">150</span>, M <span class="op">=</span> <span class="fl">10</span>, gamma <span class="op">=</span> <span class="fl">0.8</span>,print <span class="op">=</span> <span class="cn">T</span>, Int <span class="op">=</span> <span class="cn">T</span>, batch <span class="op">=</span> <span class="cn">T</span>,self_EN <span class="op">=</span> <span class="cn">F</span>,G <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre>
<p>For some smaller datasets, it may be faster to not parallelize at
all. You can use the “niche_DE_no_parallel” function in this case. It
takes the same arguments sans num_cores,outfile, and G.</p>
<pre><code><span><span class="co">#Perform Niche-DE</span></span>
<span><span class="va">NDE_obj</span> <span class="op">=</span> <span class="fu"><a href="../reference/niche_DE_no_parallel.html">niche_DE_no_parallel</a></span><span class="op">(</span><span class="va">NDE_obj</span>,C <span class="op">=</span> <span class="fl">150</span>, M <span class="op">=</span> <span class="fl">10</span>, gamma <span class="op">=</span> <span class="fl">0.8</span>,print <span class="op">=</span> <span class="cn">T</span>, Int <span class="op">=</span> <span class="cn">T</span>, batch <span class="op">=</span> <span class="cn">T</span>,self_EN <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span></code></pre>
<details><summary>
What does the output look like?
</summary><p>After running niche-DE, the ‘niche-DE’ slot in your niche-DE object
will be populated. It will be a list with length equal to the length of
sigma. Each item of that list will have an entry corresponding to each
gene. Each entry is a list with 4 items. For a given gene k.</p>
<ul>
<li>T-stat: A matrix of dimension #cell types by #cell types. Index
(i,j) represents the T_statistic corresponding to the hypothesis test of
testing whether gene k is an (index cell type i, niche cell type j)
niche gene.</li>
<li>Beta: A matrix of dimension #cell types by #cell types. Index (i,j)
represents the beta coefficient corresponding to the niche effect of
niche cell type j on index cell type i for gene</li>
<li>nulls: Which coefficients are null (no niche-DE effect computed) for
gene k.</li>
<li>var-cov: A matrix of dimension (#non nulls) by (#non nulls) . The
matrix gives the variance covariance matrix of the beta coefficients of
the niche-DE model for gene k.To save memory, this matrix is upper
triangular.</li>
<li>log-lik: The log-likelihood of the niche-DE model for gene k.</li>
</ul>
<p>Note that each item in the niche-DE list is named based on an element
of sigma and the T-stat,beta,var-cov,log-lik items for that list are
based on an effective niche calculated using a kernel bandwidth equal to
that element of sigma. Additionally, the following two slots in your
niche-DE object will be populated</p>
<ul>
<li>Niche-DE-pval-pos: Pvalues for testing if a gene is an
(index,niche)+ niche gene. This is a list with length equal to the
length of sigma. Each sublist contains 3 items.
<ul>
<li>gene-level: A list of gene level pvalues. It is a vector with length
equal to the number of genes.</li>
<li>cell-type-level: A matrix of dimension #genes by #cell types which
gives cell type level pvalues.Index (i,j) gives a pvalue corresponding
to whether gene i is a niche gene for index cell type j.</li>
<li>interaction-level: An array of dimension #cell types by #cell types
by #genes which gives interaction level pvalues. Index (i,j,k) gives a
pvalue corresponding to whether gene k is an (index cell type i, niche
cell type j)+ niche gene.</li>
</ul>
</li>
<li>Niche-DE-pval-neg: Pvalues for testing if a gene is an
(index,niche)- niche gene. This is a list with length equal to the
length of sigma. Each sublist contains 3 items.
<ul>
<li>gene-level: A list of gene level pvalues. It is a vector with length
equal to the number of genes.</li>
<li>cell-type-level: A matrix of dimension #genes by #cell types which
gives cell type level pvalues.Index (i,j) gives a pvalue corresponding
to whether gene i is a niche gene for index cell type j.</li>
<li>interaction-level: An array of dimension #cell types by #cell types
by #genes which gives interaction level pvalues. Index (i,j,k) gives a
pvalue corresponding to whether gene k is an (index cell type i, niche
cell type j)- niche gene.</li>
</ul>
</li>
</ul></details>
</div>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Kaishu Mason.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
