#make output director
dir.create(file.path(ST_dir[j], "celltrek"), showWarnings = FALSE)
dir.create(file.path(paste0(ST_dir[j], "\\celltrek"),"deconv_plots"), showWarnings = FALSE)
#read in object
sobj = readRDS(ST_path[j])
#change identities
Idents(sobj) = sobj@meta.data$Idents
#iterate over each cell type
for(cell_type in unique(Idents(sobj))){
#make output file name
outfile = paste0(ST_dir,"\\celltrek\\deconv_plots\\",cell_type,".jpeg")
make_celltrek_plots(sobj,cell_type,outfile)
}
}
A@meta.data$orig.ident
unique(sobj@meta.data$Idents)
unique(gsub("\\/", "_", sobj@meta.data$Idents))
#function for maing celltrek plots
make_celltrek_plots = function(sobj,CT,outfile){
#cells to highlight
highlight <- list(WhichCells(sobj, idents = CT))
#change names to cell type you want to highligh
names(highlight) = CT
#make file
jpeg(outfile)
print(SpatialDimPlot(sobj,cells.highlight=  highlight,cols.highlight = c("red", "grey")))
dev.off()
}
#iterate over each sample
nsamp = length(ST_path)
for(j in c(1:nsamp)){
#make output director
dir.create(file.path(ST_dir[j], "celltrek"), showWarnings = FALSE)
dir.create(file.path(paste0(ST_dir[j], "\\celltrek"),"deconv_plots"), showWarnings = FALSE)
#read in object
sobj = readRDS(ST_path[j])
sobj@meta.data$Idents = gsub("\\/", "_", sobj@meta.data$Idents)
#make initial plot
jpeg(paste0(ST_dir,"\\celltrek\\deconv_plots\\full_celltrek.jpeg"))
print(SpatialDimPlot(sobj))
dev.off()
#change identities
Idents(sobj) = sobj@meta.data$Idents
#iterate over each cell type
for(cell_type in unique(Idents(sobj))){
#make output file name
outfile = paste0(ST_dir,"\\celltrek\\deconv_plots\\",cell_type,".jpeg")
make_celltrek_plots(sobj,cell_type,outfile)
}
}
#function for maing celltrek plots
make_celltrek_plots = function(sobj,CT,outfile){
#cells to highlight
highlight <- list(WhichCells(sobj, idents = CT))
#change names to cell type you want to highligh
names(highlight) = CT
#make file
jpeg(outfile)
print(SpatialDimPlot(sobj,cells.highlight=  highlight,cols.highlight = c("red", "grey")))
dev.off()
}
#iterate over each sample
nsamp = length(ST_path)
for(j in c(1:nsamp)){
#make output director
dir.create(file.path(ST_dir[j], "celltrek"), showWarnings = FALSE)
dir.create(file.path(paste0(ST_dir[j], "\\celltrek"),"deconv_plots"), showWarnings = FALSE)
#read in object
sobj = readRDS(ST_path[j])
sobj@meta.data$Idents = gsub("\\/", "_", sobj@meta.data$Idents)
#make initial plot
jpeg(paste0(ST_dir[j],"\\celltrek\\deconv_plots\\full_celltrek.jpeg"))
print(SpatialDimPlot(sobj))
dev.off()
#change identities
Idents(sobj) = sobj@meta.data$Idents
#iterate over each cell type
for(cell_type in unique(Idents(sobj))){
#make output file name
outfile = paste0(ST_dir[j],"\\celltrek\\deconv_plots\\",cell_type,".jpeg")
make_celltrek_plots(sobj,cell_type,outfile)
}
}
#function for maing celltrek plots
make_celltrek_plots = function(sobj,CT,outfile){
#cells to highlight
highlight <- list(WhichCells(sobj, idents = CT))
#change names to cell type you want to highligh
names(highlight) = CT
#make file
jpeg(outfile)
print(SpatialDimPlot(sobj,cells.highlight=  highlight,cols.highlight = c("red", "grey")))
dev.off()
}
#iterate over each sample
nsamp = length(ST_path)
for(j in c(1:nsamp)){
#make output director
dir.create(file.path(ST_dir[j], "celltrek"), showWarnings = FALSE)
dir.create(file.path(paste0(ST_dir[j], "\\celltrek"),"deconv_plots"), showWarnings = FALSE)
#read in object
sobj = readRDS(ST_path[j])
sobj@meta.data$Idents = gsub("\\/", "_", sobj@meta.data$Idents)
#change identities
Idents(sobj) = sobj@meta.data$Idents
#make initial plot
jpeg(paste0(ST_dir[j],"\\celltrek\\deconv_plots\\full_celltrek.jpeg"))
print(SpatialDimPlot(sobj))
dev.off()
#iterate over each cell type
for(cell_type in unique(Idents(sobj))){
#make output file name
outfile = paste0(ST_dir[j],"\\celltrek\\deconv_plots\\",cell_type,".jpeg")
make_celltrek_plots(sobj,cell_type,outfile)
}
}
#function for maing celltrek plots
make_celltrek_plots = function(sobj,CT,outfile){
#cells to highlight
highlight <- list(WhichCells(sobj, idents = CT))
#change names to cell type you want to highligh
names(highlight) = CT
#make file
pdf(outfile)
print(SpatialDimPlot(sobj,cells.highlight=  highlight,cols.highlight = c("red", "grey")))
dev.off()
}
#iterate over each sample
nsamp = length(ST_path)
for(j in c(1:nsamp)){
#make output director
dir.create(file.path(ST_dir[j], "celltrek"), showWarnings = FALSE)
dir.create(file.path(paste0(ST_dir[j], "\\celltrek"),"deconv_plots"), showWarnings = FALSE)
#read in object
sobj = readRDS(ST_path[j])
sobj@meta.data$Idents = gsub("\\/", "_", sobj@meta.data$Idents)
#change identities
Idents(sobj) = sobj@meta.data$Idents
#make initial plot
jpeg(paste0(ST_dir[j],"\\celltrek\\deconv_plots\\full_celltrek.pdf"))
print(SpatialDimPlot(sobj))
dev.off()
#iterate over each cell type
for(cell_type in unique(Idents(sobj))){
#make output file name
outfile = paste0(ST_dir[j],"\\celltrek\\deconv_plots\\",cell_type,".pdf")
make_celltrek_plots(sobj,cell_type,outfile)
}
}
#iterate over each sample
nsamp = length(ST_path)
for(j in c(1:nsamp)){
#make output director
dir.create(file.path(ST_dir[j], "celltrek"), showWarnings = FALSE)
dir.create(file.path(paste0(ST_dir[j], "\\celltrek"),"deconv_plots"), showWarnings = FALSE)
#read in object
sobj = readRDS(ST_path[j])
sobj@meta.data$Idents = gsub("\\/", "_", sobj@meta.data$Idents)
#change identities
Idents(sobj) = sobj@meta.data$Idents
#make initial plot
jpeg(paste0(ST_dir[j],"\\celltrek\\deconv_plots\\full_celltrek.pdf"))
print(SpatialDimPlot(sobj))
dev.off()
# #iterate over each cell type
# for(cell_type in unique(Idents(sobj))){
#   #make output file name
#   outfile = paste0(ST_dir[j],"\\celltrek\\deconv_plots\\",cell_type,".pdf")
#   make_celltrek_plots(sobj,cell_type,outfile)
# }
}
nsamp = length(ST_path)
for(j in c(1:nsamp)){
#make output director
dir.create(file.path(ST_dir[j], "celltrek"), showWarnings = FALSE)
dir.create(file.path(paste0(ST_dir[j], "\\celltrek"),"deconv_plots"), showWarnings = FALSE)
#read in object
sobj = readRDS(ST_path[j])
sobj@meta.data$Idents = gsub("\\/", "_", sobj@meta.data$Idents)
#change identities
Idents(sobj) = sobj@meta.data$Idents
#make initial plot
pdf(paste0(ST_dir[j],"\\celltrek\\deconv_plots\\full_celltrek.pdf"))
print(SpatialDimPlot(sobj))
dev.off()
# #iterate over each cell type
# for(cell_type in unique(Idents(sobj))){
#   #make output file name
#   outfile = paste0(ST_dir[j],"\\celltrek\\deconv_plots\\",cell_type,".pdf")
#   make_celltrek_plots(sobj,cell_type,outfile)
# }
}
table(Idents(sobj))
write.csv(table(Idents(sobj)),paste0(ST_dir[j],"\\celltrek\\deconv_plots\\celltype_freq.csv"))
#iterate over each sample
nsamp = length(ST_path)
for(j in c(1:nsamp)){
#make output director
dir.create(file.path(ST_dir[j], "celltrek"), showWarnings = FALSE)
dir.create(file.path(paste0(ST_dir[j], "\\celltrek"),"deconv_plots"), showWarnings = FALSE)
#read in object
sobj = readRDS(ST_path[j])
sobj@meta.data$Idents = gsub("\\/", "_", sobj@meta.data$Idents)
#change identities
Idents(sobj) = sobj@meta.data$Idents
#write csv for cell type frequency
write.csv(table(Idents(sobj)),paste0(ST_dir[j],"\\celltrek\\deconv_plots\\celltype_freq.csv"))
#make initial plot
pdf(paste0(ST_dir[j],"\\celltrek\\deconv_plots\\full_celltrek.pdf"))
print(SpatialDimPlot(sobj))
dev.off()
# #iterate over each cell type
# for(cell_type in unique(Idents(sobj))){
#   #make output file name
#   outfile = paste0(ST_dir[j],"\\celltrek\\deconv_plots\\",cell_type,".pdf")
#   make_celltrek_plots(sobj,cell_type,outfile)
# }
}
#iterate over each sample
nsamp = length(ST_path)
for(j in c(1:nsamp)){
#make output director
dir.create(file.path(ST_dir[j], "celltrek"), showWarnings = FALSE)
dir.create(file.path(paste0(ST_dir[j], "\\celltrek"),"deconv_plots"), showWarnings = FALSE)
dir.create(file.path(paste0(ST_dir[j], "\\celltrek"),"colloc_plots"), showWarnings = FALSE)
#read in object
sobj = readRDS(ST_path[j])
sobj@meta.data$Idents = gsub("\\/", "_", sobj@meta.data$Idents)
#change identities
Idents(sobj) = sobj@meta.data$Idents
#write csv for cell type frequency
write.csv(table(Idents(sobj)),paste0(ST_dir[j],"\\celltrek\\deconv_plots\\celltype_freq.csv"))
#make initial plot
pdf(paste0(ST_dir[j],"\\celltrek\\deconv_plots\\full_celltrek.pdf"))
print(SpatialDimPlot(sobj))
dev.off()
#iterate over each cell type
# for(cell_type in unique(Idents(sobj))){
#   #make output file name
#   outfile = paste0(ST_dir[j],"\\celltrek\\deconv_plots\\",cell_type,".pdf")
#   make_celltrek_plots(sobj,cell_type,outfile)
# }
#iterate over each cell type
nct = length(unique(Idents(sobj)))
for(j in c(1:nct)){
ct1 = unique(Idents(sobj))[j]
dir.create(file.path(paste0(ST_dir[j], "\\celltrek\\colloc_plots"),ct1), showWarnings = FALSE)
for(k in c(1:nct)){
if(j!=k){
ct2 = unique(Idents(sobj))[k]
outfile = paste0(ST_dir[j],"\\celltrek\\colloc_plots\\",ct1,"\\",ct1,"_",ct2,".pdf")
make_celltrek_colloc_plots(sobj,ct1,ct2,outfile)
}
}
}
}
#function for maing celltrek plots
make_celltrek_plots = function(sobj,CT,outfile){
#cells to highlight
highlight <- list(WhichCells(sobj, idents = CT))
#change names to cell type you want to highligh
names(highlight) = CT
#make file
pdf(outfile)
print(SpatialDimPlot(sobj,cells.highlight=  highlight,cols.highlight = c("red", "grey")))
dev.off()
}
#function for maing celltrek plots
make_celltrek_colloc_plots = function(sobj,CT1,CT2,outfile){
#cells to highlight
highlight <- list(WhichCells(sobj, idents = CT),WhichCells(sobj, idents = CT2) )
#change names to cell type you want to highligh
names(highlight) = c(CT1,CT2)
#make file
pdf(outfile)
print(SpatialDimPlot(sobj,cells.highlight=  highlight,cols.highlight = c("red", "blue")))
dev.off()
}
#iterate over each sample
nsamp = length(ST_path)
for(j in c(1:nsamp)){
#make output director
dir.create(file.path(ST_dir[j], "celltrek"), showWarnings = FALSE)
dir.create(file.path(paste0(ST_dir[j], "\\celltrek"),"deconv_plots"), showWarnings = FALSE)
dir.create(file.path(paste0(ST_dir[j], "\\celltrek"),"colloc_plots"), showWarnings = FALSE)
#read in object
sobj = readRDS(ST_path[j])
sobj@meta.data$Idents = gsub("\\/", "_", sobj@meta.data$Idents)
#change identities
Idents(sobj) = sobj@meta.data$Idents
#write csv for cell type frequency
write.csv(table(Idents(sobj)),paste0(ST_dir[j],"\\celltrek\\deconv_plots\\celltype_freq.csv"))
#make initial plot
pdf(paste0(ST_dir[j],"\\celltrek\\deconv_plots\\full_celltrek.pdf"))
print(SpatialDimPlot(sobj))
dev.off()
#iterate over each cell type
# for(cell_type in unique(Idents(sobj))){
#   #make output file name
#   outfile = paste0(ST_dir[j],"\\celltrek\\deconv_plots\\",cell_type,".pdf")
#   make_celltrek_plots(sobj,cell_type,outfile)
# }
#iterate over each cell type
nct = length(unique(Idents(sobj)))
for(j in c(1:nct)){
ct1 = unique(Idents(sobj))[j]
dir.create(file.path(paste0(ST_dir[j], "\\celltrek\\colloc_plots"),ct1), showWarnings = FALSE)
for(k in c(1:nct)){
if(j!=k){
ct2 = unique(Idents(sobj))[k]
outfile = paste0(ST_dir[j],"\\celltrek\\colloc_plots\\",ct1,"\\",ct1,"_",ct2,".pdf")
make_celltrek_colloc_plots(sobj,ct1,ct2,outfile)
}
}
}
}
#function for maing celltrek plots
make_celltrek_colloc_plots = function(sobj,CT1,CT2,outfile){
#cells to highlight
highlight <- list(WhichCells(sobj, idents = CT1),WhichCells(sobj, idents = CT2) )
#change names to cell type you want to highligh
names(highlight) = c(CT1,CT2)
#make file
pdf(outfile)
print(SpatialDimPlot(sobj,cells.highlight=  highlight,cols.highlight = c("red", "blue")))
dev.off()
}
#iterate over each sample
nsamp = length(ST_path)
for(j in c(1:nsamp)){
#make output director
dir.create(file.path(ST_dir[j], "celltrek"), showWarnings = FALSE)
dir.create(file.path(paste0(ST_dir[j], "\\celltrek"),"deconv_plots"), showWarnings = FALSE)
dir.create(file.path(paste0(ST_dir[j], "\\celltrek"),"colloc_plots"), showWarnings = FALSE)
#read in object
sobj = readRDS(ST_path[j])
sobj@meta.data$Idents = gsub("\\/", "_", sobj@meta.data$Idents)
#change identities
Idents(sobj) = sobj@meta.data$Idents
#write csv for cell type frequency
write.csv(table(Idents(sobj)),paste0(ST_dir[j],"\\celltrek\\deconv_plots\\celltype_freq.csv"))
#make initial plot
pdf(paste0(ST_dir[j],"\\celltrek\\deconv_plots\\full_celltrek.pdf"))
print(SpatialDimPlot(sobj))
dev.off()
#iterate over each cell type
# for(cell_type in unique(Idents(sobj))){
#   #make output file name
#   outfile = paste0(ST_dir[j],"\\celltrek\\deconv_plots\\",cell_type,".pdf")
#   make_celltrek_plots(sobj,cell_type,outfile)
# }
#iterate over each cell type
nct = length(unique(Idents(sobj)))
for(j in c(1:nct)){
ct1 = unique(Idents(sobj))[j]
dir.create(file.path(paste0(ST_dir[j], "\\celltrek\\colloc_plots"),ct1), showWarnings = FALSE)
for(k in c(1:nct)){
if(j!=k){
ct2 = unique(Idents(sobj))[k]
outfile = paste0(ST_dir[j],"\\celltrek\\colloc_plots\\",ct1,"\\",ct1,"_",ct2,".pdf")
make_celltrek_colloc_plots(sobj,ct1,ct2,outfile)
}
}
}
}
#function for maing celltrek plots
make_celltrek_colloc_plots = function(sobj,CT1,CT2,outfile){
#cells to highlight
highlight <- list(WhichCells(sobj, idents = CT1),WhichCells(sobj, idents = CT2) )
#change names to cell type you want to highligh
names(highlight) = c(CT1,CT2)
#make file
pdf(outfile)
print(SpatialDimPlot(sobj,cells.highlight=  highlight,cols.highlight = c("red", "blue","grey")))
dev.off()
}
#iterate over each sample
nsamp = length(ST_path)
for(j in c(1:nsamp)){
#make output director
dir.create(file.path(ST_dir[j], "celltrek"), showWarnings = FALSE)
dir.create(file.path(paste0(ST_dir[j], "\\celltrek"),"deconv_plots"), showWarnings = FALSE)
dir.create(file.path(paste0(ST_dir[j], "\\celltrek"),"colloc_plots"), showWarnings = FALSE)
#read in object
sobj = readRDS(ST_path[j])
sobj@meta.data$Idents = gsub("\\/", "_", sobj@meta.data$Idents)
#change identities
Idents(sobj) = sobj@meta.data$Idents
#write csv for cell type frequency
write.csv(table(Idents(sobj)),paste0(ST_dir[j],"\\celltrek\\deconv_plots\\celltype_freq.csv"))
#make initial plot
pdf(paste0(ST_dir[j],"\\celltrek\\deconv_plots\\full_celltrek.pdf"))
print(SpatialDimPlot(sobj))
dev.off()
#iterate over each cell type
# for(cell_type in unique(Idents(sobj))){
#   #make output file name
#   outfile = paste0(ST_dir[j],"\\celltrek\\deconv_plots\\",cell_type,".pdf")
#   make_celltrek_plots(sobj,cell_type,outfile)
# }
#iterate over each cell type
nct = length(unique(Idents(sobj)))
for(j in c(1:nct)){
ct1 = unique(Idents(sobj))[j]
dir.create(file.path(paste0(ST_dir[j], "\\celltrek\\colloc_plots"),ct1), showWarnings = FALSE)
for(k in c(1:nct)){
if(j!=k){
ct2 = unique(Idents(sobj))[k]
outfile = paste0(ST_dir[j],"\\celltrek\\colloc_plots\\",ct1,"\\",ct1,"_",ct2,".pdf")
make_celltrek_colloc_plots(sobj,ct1,ct2,outfile)
}
}
}
}
dir.create(file.path(paste0(ST_dir[j], "\\celltrek\\colloc_plots"),ct1), showWarnings = FALSE)
#iterate over each sample
nsamp = length(ST_path)
for(j in c(1:nsamp)){
#make output director
dir.create(file.path(ST_dir[j], "celltrek"), showWarnings = FALSE)
dir.create(file.path(paste0(ST_dir[j], "\\celltrek"),"deconv_plots"), showWarnings = FALSE)
dir.create(file.path(paste0(ST_dir[j], "\\celltrek"),"colloc_plots"), showWarnings = FALSE)
#read in object
sobj = readRDS(ST_path[j])
sobj@meta.data$Idents = gsub("\\/", "_", sobj@meta.data$Idents)
#change identities
Idents(sobj) = sobj@meta.data$Idents
#write csv for cell type frequency
write.csv(table(Idents(sobj)),paste0(ST_dir[j],"\\celltrek\\deconv_plots\\celltype_freq.csv"))
#make initial plot
pdf(paste0(ST_dir[j],"\\celltrek\\deconv_plots\\full_celltrek.pdf"))
print(SpatialDimPlot(sobj))
dev.off()
#iterate over each cell type
# for(cell_type in unique(Idents(sobj))){
#   #make output file name
#   outfile = paste0(ST_dir[j],"\\celltrek\\deconv_plots\\",cell_type,".pdf")
#   make_celltrek_plots(sobj,cell_type,outfile)
# }
#iterate over each cell type
nct = length(unique(Idents(sobj)))
for(i in c(1:nct)){
ct1 = unique(Idents(sobj))[i]
dir.create(file.path(paste0(ST_dir[i], "\\celltrek\\colloc_plots"),ct1), showWarnings = FALSE)
for(k in c(1:nct)){
if(i!=k){
ct2 = unique(Idents(sobj))[k]
outfile = paste0(ST_dir[j],"\\celltrek\\colloc_plots\\",ct1,"\\",ct1,"_",ct2,".pdf")
make_celltrek_colloc_plots(sobj,ct1,ct2,outfile)
}
}
}
}
ct1
#iterate over each sample
nsamp = length(ST_path)
for(j in c(1:nsamp)){
#make output director
dir.create(file.path(ST_dir[j], "celltrek"), showWarnings = FALSE)
dir.create(file.path(paste0(ST_dir[j], "\\celltrek"),"deconv_plots"), showWarnings = FALSE)
dir.create(file.path(paste0(ST_dir[j], "\\celltrek"),"colloc_plots"), showWarnings = FALSE)
#read in object
sobj = readRDS(ST_path[j])
sobj@meta.data$Idents = gsub("\\/", "_", sobj@meta.data$Idents)
#change identities
Idents(sobj) = sobj@meta.data$Idents
#write csv for cell type frequency
write.csv(table(Idents(sobj)),paste0(ST_dir[j],"\\celltrek\\deconv_plots\\celltype_freq.csv"))
#make initial plot
pdf(paste0(ST_dir[j],"\\celltrek\\deconv_plots\\full_celltrek.pdf"))
print(SpatialDimPlot(sobj))
dev.off()
#iterate over each cell type
# for(cell_type in unique(Idents(sobj))){
#   #make output file name
#   outfile = paste0(ST_dir[j],"\\celltrek\\deconv_plots\\",cell_type,".pdf")
#   make_celltrek_plots(sobj,cell_type,outfile)
# }
#iterate over each cell type
nct = length(unique(Idents(sobj)))
for(i in c(1:nct)){
ct1 = unique(Idents(sobj))[i]
dir.create(file.path(paste0(ST_dir[j], "\\celltrek\\colloc_plots"),ct1), showWarnings = FALSE)
for(k in c(1:nct)){
if(i!=k){
ct2 = unique(Idents(sobj))[k]
outfile = paste0(ST_dir[j],"\\celltrek\\colloc_plots\\",ct1,"\\",ct1,"_",ct2,".pdf")
make_celltrek_colloc_plots(sobj,ct1,ct2,outfile)
}
}
}
}
?SpatialDimPlot
CT = "C_TAL"
#cells to highlight
highlight <- list(WhichCells(sobj, idents = CT))
#change names to cell type you want to highligh
names(highlight) = CT
print(SpatialDimPlot(sobj,cells.highlight=  highlight,cols.highlight = c("red", "none")))
print(SpatialDimPlot(sobj,cells.highlight=  highlight,cols.highlight = c("red", "none")))
print(SpatialDimPlot(sobj,cells.highlight=  highlight,cols.highlight = c("red", "blue")))
isobj <- Subset(sobj, subset = WhichCells(sobj, idents = CT))
print(SpatialDimPlot(isobj))
isobj <- subset(sobj, subset = WhichCells(sobj, idents = CT))
print(SpatialDimPlot(isobj))
WhichCells(sobj, idents = CT)
isobj <- subset(sobj, idents = "C_TAL")
print(SpatialDimPlot(isobj))
isobj <- subset(sobj, idents = "C_TAL")
print(SpatialDimPlot(isobj))
SpatialDimPlot(isobj)
SpatialDimPlot(sobj)
