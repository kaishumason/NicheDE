library(Matrix)
library(Seurat)
library(ggplot2)
library(abind)
library(enrichR)
library(nicheDE)
#read in niche-DE object
NDE = readRDS("integrated_kidney_NDE.rds")
#get niche-DE genes in fibroblasts when near PT cells
NDE_genes = get_niche_DE_genes(NDE,'I',index="Fibroblast",niche = "PT",pos = T,alpha = 0.05)
View(NDE_genes)
#read in niche-DE object
NDE = readRDS("integrated_2871_2873_nicheDE.rds")
#get niche-DE genes in fibroblasts when near PT cells
NDE_genes = get_niche_DE_genes(NDE,'I',index="Fibroblast",niche = "PT",pos = T,alpha = 0.05)
View(NDE_genes)
devtools::install_github("Kmason23/NicheDE") # install
detach("package:nicheDE", unload = TRUE)
remove.packages("nicheDE")
devtools::install_github("Kmason23/NicheDE") # install
library(nicheDE)
#get niche-DE genes in fibroblasts when near PT cells
NDE_genes = get_niche_DE_genes(NDE,'I',index="Fibroblast",niche = "PT",pos = T,alpha = 0.05)
View(NDE_genes)
NDE_genes = get_niche_DE_genes(NDE,'I',index="Fibroblast",niche = "PT",pos = F,alpha = 0.05)
View(NDE_genes)
NDE_genes = get_niche_DE_genes(NDE,'I',index="PT",niche = "Fibroblast",pos = F,alpha = 0.05)
View(NDE_genes)
NDE_genes = get_niche_DE_genes(NDE,'I',index="PT",niche = "Fibroblast",pos = T,alpha = 0.05)
NDE@cell_types
NDE_genes = get_niche_DE_genes(NDE,'I',index="Mac",niche = "Fibroblast",pos = F,alpha = 0.05)
NDE_genes = get_niche_DE_genes(NDE,'I',index="Mac",niche = "Fibroblast",pos = T,alpha = 0.05)
View(NDE_genes)
NDE_genes = get_niche_DE_genes(NDE,'I',index="Fibroblast",niche = "Fibroblast",pos = T,alpha = 0.05)
NDE_genes = get_niche_DE_genes(NDE,'I',index="Fibroblast",niche = "PT",pos = F,alpha = 0.05)
NDE_processes = enrichr(NDE_genes[,1],databases = 'Reactome_2016')
View(NDE_processes$Reactome_2016)
library(nicheDE)
library(ggplot2)
#make niche-DE object
Merged_NDE = readRDS('NDE_liver1_subclone.rds')
#Figure 4E)get subclone plots
coord = Merged_NDE@coord
R = matrix(c(0,-1,1,0),2,2)
coord = t(R%*%as.matrix(t(coord)))
colnames(coord) = c('x','y')
subclone_0 = which(Merged_NDE@num_cells[,2]>0)
subclone_1 = which(Merged_NDE@num_cells[,5]>0)
subclone_2 = which(Merged_NDE@num_cells[,6]>0)
colors = rep('0',nrow(coord))
D = rep(1,nrow(coord))
D[c(subclone_0,subclone_1,subclone_2)] = 1
colors[subclone_0] = '0'
colors[subclone_1] = 'subclone_1'
colors[subclone_2] = 'subclone_2'
coord = data.frame(coord,D,colors)
ggplot(coord,aes(x,y,size=ifelse(D==0,NA, D),color = colors))+geom_point(size = 1.5)+
scale_color_manual(colors, values = c('grey',"orange", "blue"))
#make niche-DE object
Merged_NDE = readRDS('NDE_liver1_subclone.rds')
setwd("C:\Users\Kaishu\Dropbox (Penn)\Kaishu_shared\Figures\niche_DE_reproducible_scripts\liver_met_analysis\subclone_analysis")
setwd("C:\\Users\\Kaishu\\Dropbox (Penn)\\Kaishu_shared\\Figures\\niche_DE_reproducible_scripts\\liver_met_analysis\\subclone_analysis")
#make niche-DE object
Merged_NDE = readRDS('NDE_liver1_subclone.rds')
#Figure 4E)get subclone plots
coord = Merged_NDE@coord
R = matrix(c(0,-1,1,0),2,2)
coord = t(R%*%as.matrix(t(coord)))
colnames(coord) = c('x','y')
subclone_0 = which(Merged_NDE@num_cells[,2]>0)
subclone_1 = which(Merged_NDE@num_cells[,5]>0)
subclone_2 = which(Merged_NDE@num_cells[,6]>0)
colors = rep('0',nrow(coord))
D = rep(1,nrow(coord))
D[c(subclone_0,subclone_1,subclone_2)] = 1
colors[subclone_0] = '0'
colors[subclone_1] = 'subclone_1'
colors[subclone_2] = 'subclone_2'
coord = data.frame(coord,D,colors)
ggplot(coord,aes(x,y,size=ifelse(D==0,NA, D),color = colors))+geom_point(size = 1.5)+
scale_color_manual(colors, values = c('grey',"orange", "blue"))
A = get_niche_DE_genes(Merged_NDE,"I","stromal","subclone_2",pos = F,0.05)
A = get_niche_DE_genes(Merged_NDE,"I","stromal","subclone_2",pos = T,0.05)
A = get_niche_DE_genes(Merged_NDE,"I","stromal","subclone_1",pos = T,0.05)
A = get_niche_DE_genes(Merged_NDE,"I","stromal","subclone_1",pos = F,0.05)
A = get_niche_DE_genes(Merged_NDE,"I","stromal","subclone_1",pos = T,0.05)
A = get_niche_DE_genes(Merged_NDE,"I","subclone_1","stromal",pos = T,0.05)
A = get_niche_DE_genes(Merged_NDE,"I","subclone_1","stromal",pos = F,0.05)
A = get_niche_DE_genes(Merged_NDE,"I","subclone_1","stromal",pos = T,0.05)
View(A)
Merged_NDE@niche_DE$`100`$IFNAR1
Merged_NDE@niche_DE$`100`$IFNGR1
setwd("C:\\Users\\Kaishu\\Dropbox (Penn)\\Visium\\niche_DE_package\\NicheDE_github")
options(rmarkdown.html_vignette.check_title = FALSE)
devtools::document()
roxygen2::roxygenise(clean = TRUE)
library(pkgdown)
pkgdown::build_site_github_pages()
pkgdown::build_site_github_pages()
pkgdown::build_site()
setwd("C:\\Users\\Kaishu\\Dropbox (Penn)\\Visium\\niche_DE_package\\NicheDE_github")
options(rmarkdown.html_vignette.check_title = FALSE)
devtools::document()
roxygen2::roxygenise(clean = TRUE)
library(pkgdown)
pkgdown::build_site_github_pages()
pkgdown::build_site()
library(Matrix)
library(Seurat)
library(ggplot2)
library(abind)
library(enrichR)
library(nicheDE)
#read in niche-DE object
NDE = readRDS("C:\\Users\\Kaishu\\Dropbox (Penn)\\Amin_Data\\integrated_2871_2873_nicheDE.rds")
#get niche-DE genes in fibroblasts when near PT cells
NDE_genes = get_niche_DE_genes(NDE,'I',index="Fibroblast",niche = "PT",pos = T,alpha = 0.05)
write.csv(NDE_genes,"C:\\Users\\Kaishu\\Dropbox (Penn)\\Kaishu_shared\\Figures\\Supplementary\\7\\7_1_fibro_PT_pos.csv")
#get ligand-receptor processes in fibroblasts when near PT cells
NDE_lr = niche_LR_spot(NDE,ligand_cell = "PT",receptor_cell = "Fibroblast",
ligand_target_matrix = niche_net_ligand_target_matrix,
lr_mat = ramilowski_ligand_receptor_list, truncation_value = 5)
write.csv(NDE_lr,"C:\\Users\\Kaishu\\Dropbox (Penn)\\Kaishu_shared\\Figures\\Supplementary\\7\\7_2_ligand_receptors.csv")
#perform pathway enrichment analysis in fibroblasts when near PT cells
NDE_processes = enrichr(NDE_genes[,1],databases = 'Reactome_2016')
View(NDE_processes$Reactome_2016)
write.csv(NDE_processes$Reactome_2016,"C:\\Users\\Kaishu\\Dropbox (Penn)\\Kaishu_shared\\Figures\\Supplementary\\7\\7_3_fibro_PT_processes.csv")
#get niche-DE genes in fibroblasts when near PT cells
NDE_genes = get_niche_DE_genes(NDE,'I',index="Fibroblast",niche = "PT",pos = T,alpha = 0.05)
write.csv(NDE_genes,"C:\\Users\\Kaishu\\Dropbox (Penn)\\Kaishu_shared\\Figures\\Supplementary\\7\\7_4_fibro_PT_pos.csv")
NDE_genes = get_niche_DE_genes(NDE,'I',index="Mac",niche = "PT",pos = T,alpha = 0.05)
setwd("C:\\Users\\Kaishu\\Dropbox (Penn)\\Visium\\scRNA_mCRC_reference")
data = readRDS("aggr_seu_SCT.rds")
library(nicheDE)
L = CreateLibraryMatrixFromSeurat(data,"RNA")
seurat_object = data
assay = "RNA"
#get desired assay from seurat object
sobj_assay = Seurat::GetAssay(seurat_object,assay)
#get counts matrix
data = Matrix::t(sobj_assay@counts)
#get cell type vector
cell_type = as.vector(Seurat::Idents(seurat_object))
names(cell_type)
cell_type = Seurat::Idents(seurat_object)
dim(data)
unique(cell_type)
names(cell_type)
setwd("C:\\Users\\Kaishu\\Dropbox (Penn)\\Visium\\niche_DE_package\\NicheDE_github")
options(rmarkdown.html_vignette.check_title = FALSE)
devtools::document()
L = CreateLibraryMatrixFromSeurat(data,"RNA")
data = readRDS("aggr_seu_SCT.rds")
L = CreateLibraryMatrixFromSeurat(data,"RNA")
setwd("C:\\Users\\Kaishu\\Dropbox (Penn)\\Visium\\scRNA_mCRC_reference")
data = readRDS("aggr_seu_SCT.rds")
L = CreateLibraryMatrixFromSeurat(data,"RNA")
setwd("C:\\Users\\Kaishu\\Dropbox (Penn)\\Visium\\niche_DE_package\\NicheDE_github")
options(rmarkdown.html_vignette.check_title = FALSE)
devtools::document()
L = CreateLibraryMatrixFromSeurat(data,"RNA")
setwd("C:\\Users\\Kaishu\\Dropbox (Penn)\\Visium\\niche_DE_package\\NicheDE_github")
options(rmarkdown.html_vignette.check_title = FALSE)
devtools::document()
roxygen2::roxygenise(clean = TRUE)
library(pkgdown)
pkgdown::build_site_github_pages()
#usethis::use_vignette("Installation")
#usethis::use_vignette("Deconvolution")
#usethis::use_vignette("Average_Expression_Profile_Calculation")
#usethis::use_vignette("Object_Creation")
#usethis::use_vignette("Object_Creation_Seurat")
#usethis::use_vignette("Effective_Niche_Calculation")
#usethis::use_vignette("Performing_Niche_DE")
#usethis::use_vignette("Getting_Niche_DE_Genes")
#usethis::use_vignette("Marker_Genes")
#usethis::use_vignette("Ligand_Receptor_Analysis")
pkgdown::build_site()
setwd("C:\\Users\\Kaishu\\Dropbox (Penn)\\Visium\\niche_DE_package\\NicheDE_github")
options(rmarkdown.html_vignette.check_title = FALSE)
devtools::document()
roxygen2::roxygenise(clean = TRUE)
library(pkgdown)
pkgdown::build_site_github_pages()
#usethis::use_vignette("Installation")
#usethis::use_vignette("Deconvolution")
#usethis::use_vignette("Average_Expression_Profile_Calculation")
#usethis::use_vignette("Object_Creation")
#usethis::use_vignette("Object_Creation_Seurat")
#usethis::use_vignette("Effective_Niche_Calculation")
#usethis::use_vignette("Performing_Niche_DE")
#usethis::use_vignette("Getting_Niche_DE_Genes")
#usethis::use_vignette("Marker_Genes")
#usethis::use_vignette("Ligand_Receptor_Analysis")
pkgdown::build_site()
setwd("C:\\Users\\Kaishu\\Dropbox (Penn)\\Visium\\niche_DE_package\\NicheDE_github")
options(rmarkdown.html_vignette.check_title = FALSE)
devtools::document()
roxygen2::roxygenise(clean = TRUE)
library(pkgdown)
pkgdown::build_site_github_pages()
#usethis::use_vignette("Installation")
#usethis::use_vignette("Deconvolution")
#usethis::use_vignette("Average_Expression_Profile_Calculation")
#usethis::use_vignette("Object_Creation")
#usethis::use_vignette("Object_Creation_Seurat")
#usethis::use_vignette("Effective_Niche_Calculation")
#usethis::use_vignette("Performing_Niche_DE")
#usethis::use_vignette("Getting_Niche_DE_Genes")
#usethis::use_vignette("Marker_Genes")
#usethis::use_vignette("Ligand_Receptor_Analysis")
pkgdown::build_site()
setwd("C:\\Users\\Kaishu\\Dropbox (Penn)\\Visium\\niche_DE_package\\NicheDE_github")
options(rmarkdown.html_vignette.check_title = FALSE)
devtools::document()
roxygen2::roxygenise(clean = TRUE)
library(pkgdown)
pkgdown::build_site_github_pages()
#usethis::use_vignette("Installation")
#usethis::use_vignette("Deconvolution")
#usethis::use_vignette("Average_Expression_Profile_Calculation")
#usethis::use_vignette("Object_Creation")
#usethis::use_vignette("Object_Creation_Seurat")
#usethis::use_vignette("Effective_Niche_Calculation")
#usethis::use_vignette("Performing_Niche_DE")
#usethis::use_vignette("Getting_Niche_DE_Genes")
#usethis::use_vignette("Marker_Genes")
#usethis::use_vignette("Ligand_Receptor_Analysis")
pkgdown::build_site()
setwd("C:\\Users\\Kaishu\\Dropbox (Penn)\\Visium\\niche_DE_package\\NicheDE_github")
options(rmarkdown.html_vignette.check_title = FALSE)
devtools::document()
roxygen2::roxygenise(clean = TRUE)
library(pkgdown)
pkgdown::build_site_github_pages()
#usethis::use_vignette("Installation")
#usethis::use_vignette("Deconvolution")
#usethis::use_vignette("Average_Expression_Profile_Calculation")
#usethis::use_vignette("Object_Creation")
#usethis::use_vignette("Object_Creation_Seurat")
#usethis::use_vignette("Effective_Niche_Calculation")
#usethis::use_vignette("Performing_Niche_DE")
#usethis::use_vignette("Getting_Niche_DE_Genes")
#usethis::use_vignette("Marker_Genes")
#usethis::use_vignette("Ligand_Receptor_Analysis")
pkgdown::build_site()
library(RCTD)
library(Matrix)
library(Seurat)
library(ggplot2)
library(patchwork)
library(foreach)
library(doParallel)
library(nicheDE)
#Make object
setwd("C:\\Users\\Kaishu\\Dropbox (Penn)\\Visium")
sobj = Load10X_Spatial("22261_visium_aligned", filename="filtered_feature_bc_matrix.h5")
#Make object and read deconvolution
deconv_est = readRDS("C:\\Users\\Kaishu\\Dropbox (Penn)\\Visium\\22261_visium_aligned\\deconv_est.rds")
#read in scrnsseq ref and L
setwd("C:\\Users\\Kaishu\\Dropbox (Penn)\\Visium\\scRNA_mCRC_reference")
L = read.table(file = "Library_reference.txt", sep = " ")
colnames(L) = toupper(colnames(L))
L = as.matrix(L)
L = L[colnames(deconv_est),]
#make NDE object
NDE = CreateNicheDEObjectFromSeurat(sobj,"Spatial",L,deconv_est,c(1,100,250))
#calculate Effective niche
NDE = CalculateEffectiveNiche(NDE)
cl <- parallel::makeCluster(4,outfile = "C:\\Users\\Kaishu\\Dropbox (Penn)\\Visium\\niche_DE_package\\logs890.txt")
doParallel::registerDoParallel(cl)
#start time of function
start_time <- Sys.time()
#run niche-DE
NDE = niche_DE_no_parallel(NDE,cluster = cl,C = 150, M = 10, gamma = 0.8,print = T,Int = T,batch = TRUE,self_EN = F)
#end time of function
end_time <- Sys.time()
print(end_time-start_time)
doParallel::stopImplicitCluster()
NDE = niche_DE_no_parallel(NDE,C = 150, M = 10, gamma = 0.8,print = T,Int = T,batch = TRUE,self_EN = F)
#end time of function
setwd("C:\\Users\\Kaishu\\Dropbox (Penn)\\Visium\\niche_DE_package\\NicheDE_github")
options(rmarkdown.html_vignette.check_title = FALSE)
devtools::document()
NDE = niche_DE_no_parallel(NDE,C = 150, M = 10, gamma = 0.8,print = T,Int = T,batch = TRUE,self_EN = F)
setwd("C:\\Users\\Kaishu\\Dropbox (Penn)\\Visium\\niche_DE_package\\NicheDE_github")
options(rmarkdown.html_vignette.check_title = FALSE)
devtools::document()
roxygen2::roxygenise(clean = TRUE)
library(pkgdown)
pkgdown::build_site_github_pages()
#usethis::use_vignette("Installation")
#usethis::use_vignette("Deconvolution")
#usethis::use_vignette("Average_Expression_Profile_Calculation")
#usethis::use_vignette("Object_Creation")
#usethis::use_vignette("Object_Creation_Seurat")
#usethis::use_vignette("Effective_Niche_Calculation")
#usethis::use_vignette("Performing_Niche_DE")
#usethis::use_vignette("Getting_Niche_DE_Genes")
#usethis::use_vignette("Marker_Genes")
#usethis::use_vignette("Ligand_Receptor_Analysis")
pkgdown::build_site()
